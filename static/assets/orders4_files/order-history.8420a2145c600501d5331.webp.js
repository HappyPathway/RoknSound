$.fn.serializeObject=function(){var o={},a=this.serializeArray();$.each(a,function(){if(o[this.name]!==undefined){if(!o[this.name].push){o[this.name]=[o[this.name]]}
o[this.name].push(this.value||'')}else{o[this.name]=this.value||''}});return o};var $_oh={_init:function(){$(document).on('click','.btn-cc-edit[href^="#pop-cc-add-"]',function(e){var $target=$($(this).attr('href'));if($target.length){$target.addClass('refresh')}}).on('click','.pay-status-close',function(e){e.preventDefault();window.location.reload()}).on('click','.btn-make-payment, .btn-cc-edit, .btn-cc-change, .btn-date-edit, .btn-cc-add',this.popup_open).on('click','.pay-pop',this.popup_close).on('click','.pay-pop .btn-submit',this.process).on('change','.cc_select_field',this.process).on('focus','.pay-pop input[name="payment_amount_value"]',function(){$('input[type="radio"]',$(this).parents('label')).click()});$(window).on('resize',function(){setTimeout(function(){$_oh.popFit()},100)});this.popFit()},popFit:function(){var pop,pop_window,pop_head,pop_controls,pop_content;$('.pay-pop').each(function(){pop=$(this);pop_head=$('.pay-pop-header',pop);pop_content=$('.pay-pop-content',pop);pop_controls=$('.pay-pop-controls',pop);if(!pop.hasClass('visible')){pop.addClass('hide')}
pop_content.css('max-height',(Math.floor(pop.height()*0.8)-pop_head.outerHeight(!0)-pop_controls.outerHeight(!0))+'px');pop.removeClass('hide')})},checkDisabled:function(element,e){return element.hasClass('impersonate-disable')},popup_open:function(e){$(".filters_open").removeClass('filters_open');var $this=$(this),href=$this.attr('href'),$target,other,$form;if(href.length==1){return}
if($_oh.checkDisabled($(this))){return!1}
other=$('.pay-pop.visible');if(other.length){other.trigger('click')}
$target=$($this.attr('href'),$this.closest('.ordercard-payments'));if($target.length){e.preventDefault();$target.addClass('visible')}
window.currentFormVals=$('form',$target).serializeObject()},popup_close:function(e){var $this=$(this),$target=$(e.target),is_close=($target.is('.btn.close')||$target.parent('.btn.close').length),is_cancel=($target.is('.btn-cancel'));if($this.hasClass('submitting')){return}
if(is_close||is_cancel||(!$target.is('.pay-pop-window')&&!$target.closest('.pay-pop-window').length)){if(is_close||is_cancel){e.preventDefault()}
if($('.pay-pop-error').length||$('.pay-pop-success').length){window.location.reload()}else{$this.removeClass('visible refresh');$(".filters_open").removeClass('filters_open');$(".filters").css({"display":"table-cell"})}
var $form=$('form',$this);if($form.length){$('input, textarea, select',$form).filter('[error]').each(function(){$(this).attr('error',!1).siblings('.note.error').remove()});var thisfield,thisname,thistype,thisval;$('input, textarea, select',$form).each(function(){thisfield=$(this);thisname=thisfield.prop('name');thistype=thisfield.prop('type');thisval=thisfield.val();if(thistype=='radio'||thistype=='checkbox'){if(!window.currentFormVals.hasOwnProperty(thisname)){thisfield.attr('checked',!1)}else if(Object.prototype.toString.call(window.currentFormVals[thisname])==='[object Array]'){var i=0,l=window.currentFormVals[thisname].length,found=!1;for(;i<l;i++){if(!window.currentFormVals[thisname].hasOwnProperty(i)){continue}
if(window.currentFormVals[thisname][i]==thisval){found=!0;break}}
if(found){thisfield.attr('checked',!0)}else{thisfield.attr('checked',!1)}}else{if(window.currentFormVals[thisname]==thisval){thisfield.attr('checked',!0)}else{thisfield.attr('checked',!1)}}}else{thisfield.val((window.currentFormVals.hasOwnProperty(thisname)?window.currentFormVals[thisname]:'')).trigger('change')}})}}},process:function(e){var $this=$(this),modal=$this.closest('.pay-pop'),$form=$('form',modal);var urlSearchParams=new URLSearchParams(window.location.search);var page=urlSearchParams.get("page");if(!page){page=1}
var searchTerm=urlSearchParams.get("searchTerm");if(!searchTerm){searchTerm=''}
var data=$form.serialize()+(modal.hasClass('refresh')?'&cc_add[mode]=edit':'')+'&RPC='+'&page='+page+'&searchTerm='+searchTerm;if(modal.hasClass('submitting')){return}
modal.addClass('submitting');$.ajax({type:"POST",url:"?",data:data,dataType:'json',cache:!1,timeout:15000,success:function(result){var $target=$('#payments-'+result.invoice_number+' .pay-pop-window');if(!result.hasOwnProperty('status')||!result.hasOwnProperty('invoice_number')||!result.hasOwnProperty('html')){modal.removeClass('submitting');$target.html('<div class="pay-pop-error"><strong>Payment Error.</strong><br>Please try again. <a href="#" class="pay-status-close">OK</a></div>');return}
if(result.status==="declined"){modal.removeClass('submitting');$target.html('<div class="pay-pop-error"><strong>Card Declined</strong><br>Please try a different card. <a href="#" class="pay-status-close">OK</a></div>');return}else if(result.status==="error"){modal.removeClass('submitting');$target.html('<div class="pay-pop-error"><strong>Payment Error.</strong><br>If the problem persists, please call <a href="tel:+18002224700">(800) 222-4700</a> for help. <a href="#" class="pay-status-close">OK</a></div>');return}
if($target.length){let message='Your payment has been received';if($('.cc-edit').hasClass('visible')||$('.cc-change').hasClass('visible')){message='Your card has been updated'}
if($('.cc-add').hasClass('visible')){message='Your card has been added'}
modal.removeClass('submitting');$target.html('<div class="pay-pop-success"><strong>Thank you!</strong><br>'+message+' <a href="#"class="pay-status-close">OK</a></div>');if($_form!==undefined&&$_form.hasOwnProperty('allFilledCheck')){$_form.allFilledCheck();$_form.errorFocus()}
$_oh.popFit()}},error:function(result){var $target=$('#payments-'+result.invoice_number+' .pay-pop-window');modal.removeClass('submitting').trigger('click');$target.html('<div class="pay-pop-error"><strong>Payment Error.</strong> Please try again. <a href="#" class="pay-status-close">OK</a></div>')}})}};$(function(){$_oh._init();$("#history-pag__input").keypress(function(e){var key=e.keyCode||e.which;var keyCode=String.fromCharCode(key);if(key===13||/^[0-9]*$/.test(keyCode)){return!0}
e.preventDefault()})});var clearSearch=document.getElementById('order-history-clear-search');clearSearch.addEventListener('click',function(e){e.preventDefault();var searchInput=document.getElementById('oh-search-box');searchInput.value="";var urlSearchParams=new URLSearchParams(window.location.search);var impersonation=urlSearchParams.get("impersonation");window.location.href="/myaccount/history/"+(impersonation?"?impersonation="+impersonation:"")})
var detailBtns=document.querySelectorAll('.toggle-details');for(var i=0;i<detailBtns.length;i++){detailBtns[i].addEventListener('click',function(e){e.preventDefault();var a=this.closest('.ordercard');var b=a.querySelector('.ordercard-details');var openHeight=b.scrollHeight;b.classList.toggle('ordercard-details__open');if(b.classList.contains('ordercard-details__open')){b.style.maxHeight=openHeight+'px'}else{b.style.maxHeight='0'}
setTimeout(function(){if(b.classList.contains('ordercard-details__open')){b.scrollIntoView({behavior:"smooth",block:"nearest"})}},200);this.classList.toggle('toggle-details__active')})}